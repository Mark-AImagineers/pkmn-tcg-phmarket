{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Login</title>
        <style>
            body {
                margin: 0;
                height: 100vh;
                background: #181818 url('{% static "img/pkmn-splash.svg" %}')
                    center/contain no-repeat;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: Arial, sans-serif;
                color: #fff;
            }

            .login-box {
                width: 100%;
                max-width: 380px;
                padding: 2rem;
                background: rgba(0, 0, 0, 0.6);
                border-radius: 1rem;
                text-align: center;
            }

            .form-input {
                width: 100%;
                padding: 0.5rem;
                border: 1px solid #ccc;
                border-radius: 0.25rem;
                margin-top: 0.25rem;
            }

            button {
                width: 100%;
                margin-top: 1rem;
                padding: 0.5rem;
                background: #4adf86;
                color: #000;
                border: none;
                border-radius: 0.25rem;
                cursor: pointer;
                font-weight: bold;
            }

            button:hover {
                background: #70e39d;
            }

            #login-result {
                margin-top: 1rem;
                color: #ffb4b4;
            }
        </style>
    </head>

    <body>
        <div class="login-box">
            <h1>PKMN PH</h1>
            <p>Welcome Back</p>
            <p class="text-sm">Donâ€™t have an account yet? <a href="#">Sign Up</a></p>

            <form
                method="post"
                hx-post="{% url 'api_login' %}"
                hx-swap="none"
                hx-on="htmx:afterRequest: handleLogin(event)"
            >
                {% csrf_token %}
                <div>
                    <label for="email">Email</label>
                    {{ form.email }}
                </div>

                <div>
                    <label for="password">Password</label>
                    {{ form.password }}
                </div>

                <button type="submit">Login</button>
            </form>

            <div id="login-result"></div>
        </div>

        <script>
            function handleLogin(e) {
                if (e.detail.xhr.status === 200) {
                    try {
                        const data = JSON.parse(e.detail.xhr.responseText);
                        if (data.access && data.refresh) {
                            localStorage.setItem('access', data.access);
                            localStorage.setItem('refresh', data.refresh);
                            window.location.href = '/';
                            return;
                        }
                    } catch (err) {
                        // fall through
                    }
                }
                document.querySelector('#login-result').innerText = 'Invalid credentials';
            }
        </script>
    </body>
</html>

